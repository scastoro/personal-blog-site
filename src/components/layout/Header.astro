---
import Navigation from './Navigation.astro';
import ThemeToggle from '../ui/ThemeToggle.astro';
---

<header class="site-header site-header--sticky">
  <div class="container">
    <div class="flex items-center justify-between py-4">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center text-xl font-semibold transition-colors hover:text-[var(--color-accent-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)] focus-visible:ring-offset-2 rounded-md"
        aria-label="Go to homepage"
      >
        <svg
          width="32"
          height="32"
          viewBox="0 0 32 32"
          class="text-[var(--color-accent-primary)] flex-shrink-0"
          role="img"
          aria-label="Personal blog logo"
        >
          <rect width="32" height="32" rx="8" fill="currentColor" opacity="0.1"/>
          <circle cx="16" cy="16" r="6" fill="currentColor"/>
        </svg>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        <Navigation />
        <ThemeToggle />
      </div>
      
      <!-- Mobile Menu Button -->
      <button 
        class="md:hidden p-2 rounded-md text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-muted)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)]"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        id="mobile-menu-button"
      >
        <svg 
          width="24" 
          height="24" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
    
    <!-- Mobile Navigation -->
    <div 
      class="md:hidden mt-4 pb-4 border-t border-[var(--color-border-default)] hidden" 
      id="mobile-menu"
      role="navigation"
      aria-label="Mobile navigation"
    >
      <div class="pt-4 space-y-4">
        <Navigation />
        <div class="flex justify-start">
          <ThemeToggle />
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  if (mobileMenuButton && mobileMenu) {
    let isOpen = false;
    
    const toggleMenu = () => {
      isOpen = !isOpen;
      mobileMenu.classList.toggle('hidden', !isOpen);
      mobileMenuButton.setAttribute('aria-expanded', isOpen.toString());
      
      // Trap focus when menu is open
      if (isOpen) {
        const focusableElements = mobileMenu.querySelectorAll(
          'a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const firstElement = focusableElements[0] as HTMLElement;
        firstElement?.focus();
      }
    };
    
    mobileMenuButton.addEventListener('click', toggleMenu);
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        toggleMenu();
        mobileMenuButton.focus();
      }
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (isOpen && !mobileMenuButton.contains(e.target as Node) && !mobileMenu.contains(e.target as Node)) {
        toggleMenu();
      }
    });
  }
</script>